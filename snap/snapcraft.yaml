# Copyright (c) 2018-2019 The Ion developers
name: ioncore
base: core18
version: 3.1.02
summary:   gaming related peer-to-peer network based digital currency
description: |
  [Ion Core](https://github.com/ioncoincore/ion) is an [MIT licensed](https://github.com/cevap/ion/blob/master/LICENSE),
  open source, gaming oriented, blockchain-based cryptocurrency with
  ultra fast transactions, low fees, high network decentralization, and
  Zero Knowledge cryptography proofs for industry-leading
  transaction anonymity. This package include QT, daemon, cli and tx
  binaries.
  
  Documentation and wiki:
  - Wiki (Ion Core):    https://github.com/ioncoincore/ion/wiki
  - Wiki (Ionomy):      https://github.com/ionomy/ion/wiki
  - Wiki (Ion Core CE): https://github.com/cevap/ion/wiki
  - Technical documentation: https://techdoc.ioncoin.org
  - Whitepaper: https://ionomy.com/en/whitepaper
  - Technical whitepaper: 
    https://github.com/ionomy/ion/wiki/ION-Technical-Whitepaper
  
  Get source code from Github: https://github.com/ioncoincore/ion.git
  Get CE source code from Github: https://github.com/cevap/ion.git
  
  Chat with Support on Discord: https://discord.gg/vuZn7gC
  
  Contact us on social networks and forums
    Instagram: https://t.me/ionomy
    Twitter:   https://twitter.com/ionomics
    Reddit:    https://www.reddit.com/r/ionomy/
    Facebook:  https://facebook.com/ionomy
  
  - [Feature request](https://github.com/ioncoincore/ion/issues/new?assignees=cevap%2C+FornaxA&labels=feature+request&template=feature_request.md&title=%5Bfeature+request%5D)
    Suggest an idea for this project
  - [I need help/support (observed by ionomy.com staff)](https://github.com/ioncoincore/ion/issues/new?assignees=MitchellCash&labels=help+wanted%2C+ionomy.com%2C+question%2C+ticket&template=i-need-help-support--observed-by-ionomy-com-staff-.md&title=%5Bticket%5D%5Bionomy.com%5D%5Bhelp+wanted%5D%5Bquestion%5D)
    Ask for help/support
  - [Report a bug](https://github.com/ioncoincore/ion/issues/new?assignees=ckti%2C+MitchellCash%2C+CeForce%2C+cevap%2C+FornaxA&labels=bug&template=report-a-bug.md&title=%5Bbug%5D)
    Create a report to help us improve Ion Core
  - [Report some random issue](https://github.com/ioncoincore/ion/issues/new?assignees=ckti%2C+MitchellCash%2C+CeForce%2C+cevap%2C+FornaxA&labels=question%2C+random+issue&template=report-some-random-issue.md&title=%5Brandom+issue%5D)
    Report a issue
  - [Testing Report](https://github.com/ioncoincore/ion/issues/new?assignees=&labels=Testing&template=testing-report.md&title=Test+Report+%5BBuild%5D+%5BOS%5D)
     Document Testing and Results
grade: stable
confinement: strict
icon: src/qt/res/src/ion.svg
apps:
  daemon:
    command: iond
    plugs: [network, network-bind, home, removable-media]
    environment:
      XDG_DATA_DIRS: $SNAP_USER_DATA:$SNAP/usr/share:$XDG_DATA_DIRS
  daemon-testnet:
    command: iond --testnet
    plugs: [network, network-bind, home, removable-media]
    environment:
      XDG_DATA_DIRS: $SNAP_USER_DATA:$SNAP/usr/share:$XDG_DATA_DIRS
  daemon-regtest:
    command: iond --regtest
    plugs: [network, network-bind, home, removable-media]
  qt:
    command: desktop-launch ion-qt
    plugs: [network, network-bind, unity7, unity8-calendar, unity8-contacts, desktop, desktop-legacy, wayland, x11, mir, opengl, home, removable-media]
    desktop: qt.desktop
  qt-testnet:
    command: desktop-launch ion-qt --testnet
    plugs: [network, network-bind, unity7, unity8-calendar, unity8-contacts, desktop, desktop-legacy, wayland, x11, mir, opengl, home, removable-media]
    desktop: qt-testnet.desktop
  qt-regtest:
    command: desktop-launch ion-qt --regtest
    plugs: [network, network-bind, unity7, unity8-calendar, unity8-contacts, desktop, desktop-legacy, wayland, x11, mir, opengl, home, removable-media]
    desktop: qt-regtest.desktop
  cli:
    command: ion-cli
    plugs: [network, network-bind, home]
  cli-testnet:
    command: ion-cli --testnet
    plugs: [network, network-bind, home]
  cli-regtest:
    command: ion-cli --regtest
    plugs: [network, network-bind, home]
  tx:
    command: ion-tx
    plugs: [home]
parts:
  ion:
    source: https://github.com/ioncoincore/ion
    source-type: git
    source-tag: v3.1.02
    plugin: nil
    override-build: |
      SHORTNAME="ion"
      if [ $SNAPCRAFT_ARCH_TRIPLET = "i386-linux-gnu" ]; then
        HOST="i686-linux-gnu"
      else
        HOST="${SNAPCRAFT_ARCH_TRIPLET}"
      fi
      # APPLY PATCHES
      echo "apply patches:"
      git apply ${SNAPCRAFT_STAGE}/default_data_dir.patch
      git apply ${SNAPCRAFT_STAGE}/fix-bdb-tmp-folder.patch
      git apply ${SNAPCRAFT_STAGE}/fix-use-snap-instead-of-dirty.patch
      sed -i 's/tar --strip-components/tar --no-same-owner --strip-components/' ${SNAPCRAFT_PART_BUILD}/depends/funcs.mk
      # BUILD DEPENDENCIES
      echo "START BUILDING ${SHORTNAME} FOR ${SNAPCRAFT_ARCH_TRIPLET} architecture"
      cd ${SNAPCRAFT_PART_BUILD}/depends
      make download-linux
      make -j4 HOST=${HOST}
      # CONFIGURE
      echo "Configure ${SHORTNAME}"
      cd ${SNAPCRAFT_PART_BUILD}
      echo "Configure and build ${SHORTNAME}"
      ./autogen.sh
      ./configure --prefix=`pwd`/depends/${HOST}
      # COMPILE
      echo "Compile ${SHORTNAME}"
      make -j4
      # INSTALL
      echo "Install ${SHORTNAME}"
      make install prefix=${SNAPCRAFT_PART_INSTALL}
      # POST INSTALL
      if [ $SNAPCRAFT_ARCH_TRIPLET = "powerpc64le-linux-gnu" ]; then
        if [ -e $SNAPCRAFT_PART_BUILD/src/qt/${SHORTNAME}-qt ]; then
          echo "PPC64EL fix - ${SHORTNAME}-qt exists, fix unrequired"
        else
          echo "echo ${SHORTNAME}-qt is not installed" > ${SNAPCRAFT_PART_INSTALL}/usr/bin/${SHORTNAME}-qt
          chmod +x ${SNAPCRAFT_PART_INSTALL}/usr/bin/${SHORTNAME}-qt
          echo "PPC64EL fix - ${SHORTNAME}-qt exists, fix required, dummy as ${SHORTNAME}-qt"
        fi
      fi
      echo "Installed files:"
      find ${SNAPCRAFT_PART_INSTALL} -type f
    build-packages:
      - curl
      - wget
      - gcc
      - gcc-8
      - g++
      - g++-8
      - make
      - autoconf
      - automake
      - cmake
      - pkg-config
      - libtool
      - bsdmainutils
      - binutils
      - python3
    stage-packages:
      - libxkbcommon0
      - ttf-ubuntu-font-family
      - dmz-cursor-theme
      - light-themes
      - shared-mime-info
      - libqt5gui5
      - libgdk-pixbuf2.0-0
      - libqt5svg5 # for loading icon themes which are svg
      - locales-all
      - qtwayland5
      - ca-certificates
    after:
      - patches
  patches:
    source: snap/local/patches
    plugin: dump
    prime:
      - -*
  desktop:
    source: snap/usr/share/applications
    plugin: dump