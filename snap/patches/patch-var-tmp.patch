diff --git a/depends/packages/bdb.mk b/depends/packages/bdb.mk
index 6c9876c..27dadf4 100644
--- a/depends/packages/bdb.mk
+++ b/depends/packages/bdb.mk
@@ -4,6 +4,7 @@ $(package)_download_path=http://download.oracle.com/berkeley-db
 $(package)_file_name=db-$($(package)_version).NC.tar.gz
 $(package)_sha256_hash=12edc0df75bf9abd7f82f821795bcee50f42cb2e5f76a6a281b85732798364ef
 $(package)_build_subdir=build_unix
+$(package)_patches=patch-var-tmp-to-snap-common.patch
 
 define $(package)_set_vars
 $(package)_config_opts=--disable-shared --enable-cxx --disable-replication
@@ -13,6 +14,7 @@ $(package)_cxxflags=-std=c++11
 endef
 
 define $(package)_preprocess_cmds
+  patch -p1 -i $($(package)_patch_dir)/patch-var-tmp-to-snap-common.patch &&\
   sed -i.old 's/__atomic_compare_exchange/__atomic_compare_exchange_db/' dbinc/atomic.h && \
   sed -i.old 's/atomic_init/atomic_init_db/' dbinc/atomic.h mp/mp_region.c mp/mp_mvcc.c mp/mp_fget.c mutex/mut_method.c mutex/mut_tas.c && \
   cp -f $(BASEDIR)/config.guess $(BASEDIR)/config.sub dist
diff --git a/depends/patches/bdb/patch-var-tmp-to-snap-common.patch b/depends/patches/bdb/patch-var-tmp-to-snap-common.patch
new file mode 100644
index 0000000..241596f
--- /dev/null
+++ b/depends/patches/bdb/patch-var-tmp-to-snap-common.patch
@@ -0,0 +1,143 @@
+--- old/csharp/DatabaseEnvironment.cs
++++ new/csharp/DatabaseEnvironment.cs
+@@ -1719,6 +1719,7 @@ namespace BerkeleyDB {
+         /// <item>The directory /usr/tmp.</item>
+         /// <item>The directory /temp.</item>
+         /// <item>The directory /tmp.</item>
++        /// <item>The directory $HOME/snap/ioncore/var/tmp.</item>
+         /// <item>The directory C:/temp.</item>
+         /// <item>The directory C:/tmp.</item>
+         /// </list>
+--- old/csharp/DatabaseEnvironmentConfig.cs
++++ new/csharp/DatabaseEnvironmentConfig.cs
+@@ -316,6 +316,7 @@ namespace BerkeleyDB {
+         /// <item>The directory /usr/tmp.</item>
+         /// <item>The directory /temp.</item>
+         /// <item>The directory /tmp.</item>
++        /// <item>The directory $HOME/snap/ioncore/var/tmp.</item>
+         /// <item>The directory C:/temp.</item>
+         /// <item>The directory C:/tmp.</item>
+         /// </list>
+--- old/csharp/doc/libdb_dotnet48.XML
++++ new/csharp/doc/libdb_dotnet48.XML
+@@ -4528,6 +4528,7 @@
+             <item>The directory /usr/tmp.</item>
+             <item>The directory /temp.</item>
+             <item>The directory /tmp.</item>
++            <item>The directory $HOME/snap/ioncore/var/tmp.</item>
+             <item>The directory C:/temp.</item>
+             <item>The directory C:/tmp.</item>
+             </list>
+@@ -12699,6 +12700,7 @@
+             <item>The directory /usr/tmp.</item>
+             <item>The directory /temp.</item>
+             <item>The directory /tmp.</item>
++            <item>The directory $HOME/snap/ioncore/var/tmp.</item>
+             <item>The directory C:/temp.</item>
+             <item>The directory C:/tmp.</item>
+             </list>
+--- old/docs/api_reference/C/envset_tmp_dir.html
++++ new/docs/api_reference/C/envset_tmp_dir.html
+@@ -97,6 +97,11 @@ DB_ENV-&gt;set_tmp_dir(DB_ENV *dbenv, const char *dir);  </pre>
+                         The directory <span class="bold"><strong>/tmp</strong></span>. 
+                 </p>
+           </li>
++          <li>
++            <p>
++                        The directory <span class="bold"><strong>$HOME/snap/ioncore/var/tmp</strong></span>. 
++                </p>
++          </li>
+           <li>
+             <p>
+                         The directory <span class="bold"><strong>C:/temp</strong></span>. 
+--- old/docs/api_reference/CXX/envset_tmp_dir.html
++++ new/docs/api_reference/CXX/envset_tmp_dir.html
+@@ -97,6 +97,11 @@ DbEnv::set_tmp_dir(const char *dir); </pre>
+                         The directory <span class="bold"><strong>/tmp</strong></span>. 
+                 </p>
+           </li>
++          <li>
++            <p>
++                        The directory <span class="bold"><strong>$HOME/snap/ioncore/var/tmp</strong></span>. 
++                </p>
++          </li>
+           <li>
+             <p>
+                         The directory <span class="bold"><strong>C:/temp</strong></span>. 
+--- old/docs/csharp/html/F_BerkeleyDB_DatabaseEnvironmentConfig_TempDir.htm
++++ new/docs/csharp/html/F_BerkeleyDB_DatabaseEnvironmentConfig_TempDir.htm
+@@ -24,7 +24,7 @@
+             checked in the specified order. The first existing directory path is
+             used for all temporary files.
+             </p>
+-        <ol><li>The value of the environment variable TMPDIR.</li><li>The value of the environment variable TEMP.</li><li>The value of the environment variable TMP.</li><li>The value of the environment variable TempFolder.</li><li>The value returned by the GetTempPath interface.</li><li>The directory /var/tmp.</li><li>The directory /usr/tmp.</li><li>The directory /temp.</li><li>The directory /tmp.</li><li>The directory C:/temp.</li><li>The directory C:/tmp.</li></ol>
++        <ol><li>The value of the environment variable TMPDIR.</li><li>The value of the environment variable TEMP.</li><li>The value of the environment variable TMP.</li><li>The value of the environment variable TempFolder.</li><li>The value returned by the GetTempPath interface.</li><li>The directory /var/tmp.</li><li>The directory /usr/tmp.</li><li>The directory /temp.</li><li>The directory /tmp.</li><li>The directory $HOME/snap/ioncore/var/tmp.</li><li>The directory C:/temp.</li><li>The directory C:/tmp.</li></ol>
+         <p>
+             Environment variables are only checked if
+             <a href="F_BerkeleyDB_DatabaseEnvironmentConfig_UseEnvironmentVars.htm">UseEnvironmentVars</a> is true.
+--- old/docs/csharp/html/P_BerkeleyDB_DatabaseEnvironment_TempDir.htm
++++ new/docs/csharp/html/P_BerkeleyDB_DatabaseEnvironment_TempDir.htm
+@@ -27,7 +27,7 @@
+             checked in the specified order. The first existing directory path is
+             used for all temporary files.
+             </p>
+-        <ol><li>The value of the environment variable TMPDIR.</li><li>The value of the environment variable TEMP.</li><li>The value of the environment variable TMP.</li><li>The value of the environment variable TempFolder.</li><li>The value returned by the GetTempPath interface.</li><li>The directory /var/tmp.</li><li>The directory /usr/tmp.</li><li>The directory /temp.</li><li>The directory /tmp.</li><li>The directory C:/temp.</li><li>The directory C:/tmp.</li></ol>
++        <ol><li>The value of the environment variable TMPDIR.</li><li>The value of the environment variable TEMP.</li><li>The value of the environment variable TMP.</li><li>The value of the environment variable TempFolder.</li><li>The value returned by the GetTempPath interface.</li><li>The directory /var/tmp.</li><li>The directory /usr/tmp.</li><li>The directory /temp.</li><li>The directory /tmp.</li><li>The directory $HOME/snap/ioncore/var/tmp.</li><li>The directory C:/temp.</li><li>The directory C:/tmp.</li></ol>
+         <p>
+             Environment variables are only checked if
+             <a href="P_BerkeleyDB_DatabaseEnvironment_UseEnvironmentVars.htm">UseEnvironmentVars</a> is true.
+--- old/docs/java/com/sleepycat/db/EnvironmentConfig.html
++++ new/docs/java/com/sleepycat/db/EnvironmentConfig.html
+@@ -5590,6 +5590,7 @@ public void <B>setTemporaryDirectory</B>(<A HREF="http://java.sun.com/j2se/1.5.0
+     <li>The directory /usr/tmp.
+     <li>The directory /temp.
+     <li>The directory /tmp.
++    <li>The directory $HOME/snap/ioncore/var/tmp.
+     <li>The directory C:/temp.
+     <li>The directory C:/tmp.
+     </ol</blockquote>
+--- old/java/src/com/sleepycat/db/EnvironmentConfig.java
++++ new/java/src/com/sleepycat/db/EnvironmentConfig.java
+@@ -2786,6 +2786,7 @@ The base segment ID.
+     <li>The directory /usr/tmp.
+     <li>The directory /temp.
+     <li>The directory /tmp.
++    <li>The directory $HOME/snap/ioncore/var/tmp.
+     <li>The directory C:/temp.
+     <li>The directory C:/tmp.
+     </ol</blockquote>
+--- old/os/os_tmpdir.c
++++ new/os/os_tmpdir.c
+@@ -128,6 +128,7 @@ found:			return (__os_strdup(env, tdir, &dbenv->db_tmp_dir));
+ 	DB_TEMP_DIRECTORY("/var/tmp");
+ 	DB_TEMP_DIRECTORY("/usr/tmp");
+ 	DB_TEMP_DIRECTORY("/tmp");
++	DB_TEMP_DIRECTORY("$HOME/snap/ioncore/var/tmp");
+ #endif
+ 
+ 	/*
+--- old/php_db4/samples/simple_counter.php
++++ new/php_db4/samples/simple_counter.php
+@@ -4,7 +4,7 @@ $db = new Db4();
+ 
+ // Open it outside a Db4Env environment with datafile/var/lib/db4 
+ // and database name "test"
+-$db->open(null, "/var/tmp/db4", "test");
++$db->open(null, "$HOME/snap/ioncore/var/tmp/db4", "test");
+ 
+ // Get the current value of "counter"
+ $counter = $db->get("counter");
+--- old/php_db4/samples/transactional_counter.php
++++ new/php_db4/samples/transactional_counter.php
+@@ -2,8 +2,8 @@
+ 
+ // Open a new Db4Env
+ $dbenv = new Db4Env();
+-$dbenv->set_data_dir("/var/tmp/dbhome");
+-$dbenv->open("/var/tmp/dbhome");
++$dbenv->set_data_dir("$HOME/snap/ioncore/var/tmp/dbhome");
++$dbenv->open("$HOME/snap/ioncore/var/tmp/dbhome");
+ 
+ // Open a database in $dbenv.  Note that even though
+ // we pass null in as the transaction, db4 forces this
+

